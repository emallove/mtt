#
# Simple script to dump *some* data from a
# one database 'db1' into a test database 'db2'
#
# Usage -
#   tcsh: source make_test_db
#   bash: . make_test_db
#

psql -d db1 -U mtt -c 'COPY compute_cluster   TO STDOUT' | psql -d db2 -U mtt -c 'COPY compute_cluster   FROM STDIN';
psql -d db1 -U mtt -c 'COPY submit            TO STDOUT' | psql -d db2 -U mtt -c 'COPY submit            FROM STDIN';
psql -d db1 -U mtt -c 'COPY mpi_get           TO STDOUT' | psql -d db2 -U mtt -c 'COPY mpi_get           FROM STDIN';
psql -d db1 -U mtt -c 'COPY compiler          TO STDOUT' | psql -d db2 -U mtt -c 'COPY compiler          FROM STDIN';
psql -d db1 -U mtt -c 'COPY mpi_install       TO STDOUT' | psql -d db2 -U mtt -c 'COPY mpi_install       FROM STDIN';
psql -d db1 -U mtt -c 'COPY test_build        TO STDOUT' | psql -d db2 -U mtt -c 'COPY test_build        FROM STDIN';
psql -d db1 -U mtt -c 'COPY test_run          TO STDOUT' | psql -d db2 -U mtt -c 'COPY test_run          FROM STDIN';
psql -d db1 -U mtt -c 'COPY latency_bandwidth TO STDOUT' | psql -d db2 -U mtt -c 'COPY latency_bandwidth FROM STDIN';

# 24 hours worth of results
psql -d db1 -U mtt -c "DROP TABLE temp"
psql -d db1 -U mtt -c "SELECT * INTO temp FROM results WHERE start_timestamp > now() - interval '24 hours'"
psql -d db1 -U mtt -c "COPY temp TO STDOUT" | psql -d db2 -U mtt -c 'COPY results FROM STDIN';
psql -d db1 -U mtt -c "DROP TABLE temp"

psql -d db1 -U mtt -c 'COPY alerts            TO STDOUT' | psql -d db2 -U mtt -c 'COPY alerts           FROM STDIN';
psql -d db1 -U mtt -c 'COPY users             TO STDOUT' | psql -d db2 -U mtt -c 'COPY users            FROM STDIN';
psql -d db1 -U mtt -c 'COPY failure           TO STDOUT' | psql -d db2 -U mtt -c 'COPY failure          FROM STDIN';
psql -d db1 -U mtt -c 'COPY cluster_owner     TO STDOUT' | psql -d db2 -U mtt -c 'COPY cluster_owner    FROM STDIN';
